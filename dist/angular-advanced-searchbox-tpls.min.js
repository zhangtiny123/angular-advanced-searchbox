/*! 
 * angular-advanced-searchbox v2.0.27
 * https://github.com/dnauck/angular-advanced-searchbox
 * Copyright (c) 2015 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */
!function(){"use strict";angular.module("angular-advanced-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",placeholder:"@"},replace:!0,templateUrl:"angular-advanced-searchbox.html",controller:["$scope","$attrs","$element","$timeout","$filter",function(a,b,c,d,e){function f(){this.length=8,this.timestamp=+new Date;var a=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};this.generate=function(){for(var b=this.timestamp.toString(),c=b.split("").reverse(),d="",e=0;e<this.length;++e){var f=a(0,c.length-1);d+=c[f]}return d}}function g(){angular.forEach(a.model,function(b,c){if("query"===c&&a.searchQuery!==b[0])a.searchQuery=b[0];else{var d=e("filter")(a.parameters,function(a){return a.key===c})[0],f=e("filter")(a.searchParams,function(a){return a.key===c});void 0!==d&&angular.forEach(b,function(b){var c=e("filter")(f,function(a){return a.id===b.id})[0];void 0===c?a.addSearchParam(d,b,!1):void 0!==c&&c.value!==b.value&&(c.value=b.value)})}})}function h(){var a=document.getElementsByClassName("nit-search-parameter-input")[0];a.minWidth=120;var b=a.parentElement.getBoundingClientRect(),c=document.getElementsByClassName("nit-search-parameter"),d=0;if(c.length>0){var e=c[c.length-1].getBoundingClientRect();d=b.width-(e.left+e.width-b.left)-67}d&&d>=a.minWidth?a.style.width=d+"px":a.style.width=b.width-60+"px"}function i(b,c){k&&d.cancel(k),l=e("filter")(l,function(a){return a.key!==c.key}),l.push({command:b,key:c.key,item:{id:c.id||null,value:c.value,editMode:c.editMode}}),k=d(function(){angular.forEach(l,function(b){switch(b.command){case"delete":"query"===b.key?a.model[b.key]=[]:a.model[b.key]=e("filter")(a.model[b.key],function(a){return a.id!==b.item.id});break;case"add":void 0===a.model[b.key]&&(a.model[b.key]=[]),a.model[b.key].push(b.item);break;case"change":if("query"===b.key)a.model[b.key]=[],a.model[b.key].push(b.item.value);else{var c=e("filter")(a.model[b.key],function(a){return a.id===b.item.id})[0];c&&(c.value=b.item.value,c.editMode=b.item.editMode)}}}),l.length=0},10)}function j(a){if(!a)return 0;if("number"==typeof a.selectionStart)return"backward"===a.selectionDirection?a.selectionStart:a.selectionEnd;if(document.selection){a.focus();var b=document.selection.createRange(),c=document.selection.createRange().text.length;return b.moveStart("character",-a.value.length),b.text.length-c}return 0}a.placeholder=a.placeholder||"Search ...",a.searchParams=[],a.searchQuery="",a.setSearchFocus=!1;var k,l=[],m=new f;a.$watch("model",function(b,c){angular.equals(b,c)||(g(),angular.forEach(a.searchParams,function(b,c){if(!a.model.hasOwnProperty(b.key)){var d=a.searchParams.map(function(a){return a.key}).indexOf(b.key);a.removeSearchParam(d)}}))},!0),a.$watch("focus",function(a,b){if(a===!0){var c=document.activeElement.getBoundingClientRect(),d=document.activeElement.parentElement.parentElement.getBoundingClientRect();document.getElementsByClassName("nit-suggest-drop-down")[0].style.top=d.height+"px",document.getElementsByClassName("nit-suggest-drop-down")[0].style.left=c.left-d.left+"px",document.getElementsByClassName("nit-suggest-drop-down")[0].style.maxHeight=window.innerHeight-c.height-10+"px"}}),a.getMySuggestions=function(a,b){return""===b||" "===b?a.suggestions:e("filter")(a.suggestions,function(a){return-1!==a.name.toLowerCase().indexOf(b.toLowerCase())})},a.focusSearchBox=function(){a.focus||(a.setSearchFocus=!0)},a.isActiveBox=function(){var b=e("filter")(a.searchParams,function(a){return a.editMode===!0});return a.focus||0!==b.length},a.searchParamValueChanged=function(a){i("change",a)},a.itemOnSelect=function(a){i("change",a)},a.searchQueryChanged=function(a){var b={key:"query",value:a};i("change",b)},a.enterEditMode=function(b){if(void 0!==b){var c=a.searchParams[b];c.editMode=!0,d(h,50),i("change",c)}},a.leaveEditMode=function(b){if(void 0!==b){var c=a.searchParams[b];c.editMode=!1,i("change",c),0===c.value.length&&a.removeSearchParam(b),d(h,50)}},a.typeaheadOnSelect=function(b,c,d){a.addSearchParam(b),a.searchQuery="";var e={key:"query",value:null};i("delete",e)},a.addSearchParam=function(b,c,e){void 0===e&&(e=!0);var f={id:m.generate(),key:b.key,name:b.name,placeholder:b.placeholder,value:c||"",suggestions:b.suggestions,editMode:e};a.searchParams.push(f),document.getElementsByClassName("nit-search-parameter-input")[0].style.width="50px",d(h,50),i("add",f)},a.removeSearchParam=function(b){if(void 0!==b){var c=a.searchParams[b];a.searchParams.splice(b,1),d(h,50),i("delete",c)}},a.removeAll=function(){a.searchParams.length=0,a.searchQuery="",a.model={},d(h,50)},a.editPrevious=function(b){void 0!==b&&a.leaveEditMode(b),b>0?a.enterEditMode(b-1):a.searchParams.length>0&&a.enterEditMode(a.searchParams.length-1)},a.editNext=function(b){void 0!==b&&(a.leaveEditMode(b),b<a.searchParams.length-1?a.enterEditMode(b+1):a.setSearchFocus=!0)},a.keydown=function(b,c){var d=[8,9,13,37,39];if(-1!==d.indexOf(b.which)){var e=j(b.target);8==b.which?0===e&&a.editPrevious(c):9==b.which?b.shiftKey?(b.preventDefault(),a.editPrevious(c)):(b.preventDefault(),a.editNext(c)):13==b.which?a.editNext(c):37==b.which?0===e&&a.editPrevious(c):39==b.which&&e===b.target.value.length&&a.editNext(c)}},void 0===a.model?a.model={}:g()}]}}).directive("nitSetFocus",["$timeout","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=b(e.nitSetFocus);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})}),d.bind("blur",function(){c.$apply(f.assign(c,!1))})}}}]).directive("nitSuggestionClickOpen",["$parse",function(a){return{restrict:"A",require:"ngModel",link:function(a,b,c){var d;return d=function(a){if(!b[0].value){var c,d;return c=b.controller("ngModel"),d=c.$modelValue.key||"",c.$setViewValue(d?"":" ")}},b.bind("click",d)}}}]).directive("nitAutoSizeInput",[function(){return{restrict:"A",scope:{model:"=ngModel"},link:function(a,b,c){function d(){f.textContent=b.val()||b.attr("placeholder"),b.css("width",f.offsetWidth+10)}var e=angular.element('<div style="position: fixed; top: -9999px; left: 0;"></div>'),f=document.createElement("span");f.style.whiteSpace="pre";var g="none"===b.css("maxWidth")?b.parent().innerWidth():b.css("maxWidth");b.css("maxWidth",g),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(a){f.style[a]=b.css(a)}),angular.element(document).find("body").append(e.append(f)),d(),a.model?a.$watch("model",function(){d()}):b.on("keypress keyup keydown focus input propertychange change",function(){d()})}}}])}(),angular.module("angular-advanced-searchbox").run(["$templateCache",function(a){"use strict";a.put("angular-advanced-searchbox.html",'<div class=box-container><div class=advancedSearchBox ng-class="{active : isActiveBox()}" ng-init="focus = false"><span ng-show="searchParams.length < 1 && searchQuery.length === 0" class="search-icon glyphicon glyphicon-search"></span> <a ng-href="" ng-show="searchParams.length > 0 || searchQuery.length > 0" ng-click=removeAll() role=button><span class="remove-all-icon glyphicon glyphicon-trash"></span></a><div class=nit-search-parameter ng-repeat="searchParam in searchParams"><a ng-href="" ng-click=removeSearchParam($index) role=button><span class="remove glyphicon glyphicon-remove"></span></a><div class=key ng-click=enterEditMode($index)>{{searchParam.name}} :</div><div class=value><span ng-if=!searchParam.editMode ng-click=enterEditMode($index)>{{searchParam.value.name || searchParam.value}}</span> <input name=value nit-auto-size-input nit-suggestion-click-open nit-set-focus=searchParam.editMode ng-keydown="keydown($event, $index)" ng-change=searchParamValueChanged(searchParam) ng-show=searchParam.editMode ng-blur=leaveEditMode($index) ng-model=searchParam.value typeahead-on-select=itemOnSelect(searchParam) typeahead="suggestion as suggestion.name for suggestion in getMySuggestions(searchParam, $viewValue)" placeholder="{{searchParam.placeholder}}"></div></div><input name=searchbox class=nit-search-parameter-input ng-click=focusSearchBox() nit-set-focus=setSearchFocus ng-keydown=keydown($event) placeholder={{placeholder}} ng-focus="focus = true" ng-blur="focus = false" typeahead-on-select="typeaheadOnSelect($item, $model, $label)" typeahead="parameter as parameter.name for parameter in parameters | filter:{name:$viewValue} | limitTo:8" ng-change=searchQueryChanged(searchQuery) ng-model="searchQuery"></div><div class=nit-suggest-drop-down ng-show="parameters && focus && searchQuery == \'\'"><ul><li ng-mousedown=addSearchParam(param) ng-repeat="param in parameters">{{param.name}}</li></ul></div></div>')}]);